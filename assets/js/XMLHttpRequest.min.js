/**
* XMLHttpRequest.js Copyright (C) 2011 Sergey Ilinsky (http://www.ilinsky.com)
*/
!function(){function t(){this._object=!window.XMLHttpRequest||d?new window.ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest.isNormalizedObject?new i:new window.XMLHttpRequest,this._listeners=[]}function e(){return new t}function n(t){if(t._object.send(t._data),p&&!t._async)for(t.readyState=e.OPENED,r(t);t.readyState<e.DONE;)if(t.readyState++,o(t),t._aborted)return}function o(t){e.onreadystatechange&&e.onreadystatechange.apply(t),t.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:(new Date).getTime()})}function a(t){var e=t.responseXML,n=t.responseText;return c&&n&&e&&!e.documentElement&&t.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.validateOnParse=!1,e.loadXML(n)),e&&(c&&0!=e.parseError||!e.documentElement||e.documentElement&&"parsererror"==e.documentElement.tagName)?null:e}function r(t){try{t.responseText=t._object.responseText}catch(e){}try{t.responseXML=a(t._object)}catch(e){}try{t.status=t._object.status}catch(e){}try{t.statusText=t._object.statusText}catch(e){}}function s(t){t._object.onreadystatechange=new window.Function}var i=window.XMLHttpRequest,p=!!window.controllers,c=!!window.document.namespaces,d=c&&window.navigator.userAgent.match(/MSIE 7.0/);e.prototype=t.prototype,p&&i.wrapped&&(e.wrapped=i.wrapped),e.isNormalizedObject=!0,e.UNSENT=0,e.OPENED=1,e.HEADERS_RECEIVED=2,e.LOADING=3,e.DONE=4,e.prototype.UNSENT=e.UNSENT,e.prototype.OPENED=e.OPENED,e.prototype.HEADERS_RECEIVED=e.HEADERS_RECEIVED,e.prototype.LOADING=e.LOADING,e.prototype.DONE=e.DONE,e.prototype.readyState=e.UNSENT,e.prototype.responseText="",e.prototype.responseXML=null,e.prototype.status=0,e.prototype.statusText="",e.prototype.priority="NORMAL",e.prototype.onreadystatechange=null,e.onreadystatechange=null,e.onopen=null,e.onsend=null,e.onabort=null,e.prototype.open=function(t,n,a,i,d){var u=t.toLowerCase();if("connect"==u||"trace"==u||"track"==u)throw new Error(18);delete this._headers,arguments.length<3&&(a=!0),this._async=a;var h=this,l=this.readyState,y=null;c&&a&&(y=function(){l!=e.DONE&&(s(h),h.abort())},window.attachEvent("onunload",y)),e.onopen&&e.onopen.apply(this,arguments),arguments.length>4?this._object.open(t,n,a,i,d):arguments.length>3?this._object.open(t,n,a,i):this._object.open(t,n,a),this.readyState=e.OPENED,o(this),this._object.onreadystatechange=function(){return!p||a?(h.readyState=h._object.readyState,r(h),h._aborted?void(h.readyState=e.UNSENT):void(h.readyState==e.DONE&&(delete h._data,s(h),c&&a&&window.detachEvent("onunload",y),l!=h.readyState&&o(h),l=h.readyState))):void 0}},e.prototype.send=function(t){e.onsend&&e.onsend.apply(this,arguments),arguments.length||(t=null),t&&t.nodeType&&(t=window.XMLSerializer?(new window.XMLSerializer).serializeToString(t):t.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=t,n(this)},e.prototype.abort=function(){e.onabort&&e.onabort.apply(this,arguments),this.readyState>e.UNSENT&&(this._aborted=!0),this._object.abort(),s(this),this.readyState=e.UNSENT,delete this._data},e.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},e.prototype.getResponseHeader=function(t){return this._object.getResponseHeader(t)},e.prototype.setRequestHeader=function(t,e){return this._headers||(this._headers={}),this._headers[t]=e,this._object.setRequestHeader(t,e)},e.prototype.addEventListener=function(t,e,n){for(var o,a=0;o=this._listeners[a];a++)if(o[0]==t&&o[1]==e&&o[2]==n)return;this._listeners.push([t,e,n])},e.prototype.removeEventListener=function(t,e,n){for(var o,a=0;(o=this._listeners[a])&&(o[0]!=t||o[1]!=e||o[2]!=n);a++);o&&this._listeners.splice(a,1)},e.prototype.dispatchEvent=function(t){var e={type:t.type,target:this,currentTarget:this,eventPhase:2,bubbles:t.bubbles,cancelable:t.cancelable,timeStamp:t.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==e.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[e]);for(var n,o=0;n=this._listeners[o];o++)n[0]!=e.type||n[2]||(n[1].handleEvent||n[1]).apply(this,[e])},e.prototype.toString=function(){return"[object XMLHttpRequest]"},e.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(t,e){e||(e=[]),t.__func=this,t.__func(e[0],e[1],e[2],e[3],e[4]),delete t.__func}),window.XMLHttpRequest=e}();